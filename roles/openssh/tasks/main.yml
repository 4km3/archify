---
- name: Install OpenSSH
  tags: openssh
  become: no
  aur:
    skip_installed: yes
    name: openssh

- name: Configure OpenSSH
  tags: openssh
  become: yes
  lineinfile:
    dest: /etc/ssh/sshd_config
    backup: yes
    insertafter: '^#PasswordAuthentication yes'
    regexp: '^PasswordAuthentication'
    line: 'PasswordAuthentication no'
  notify:
    - Restart OpenSSH

- name: Restrict HostKeyAlgorithms to ed25519
  tags: openssh
  become: yes
  lineinfile:
    dest: /etc/ssh/sshd_config
    backup: yes
    insertbefore: '^#HostKey /'
    regexp: '^HostKeyAlgorithms'
    line: 'HostKeyAlgorithms ssh-ed25519-cert-v01@openssh.com,ssh-ed25519'
  notify:
    - Restart OpenSSH

# - name: Relax root access
#   become: yes
#   tags: openssh
#   lineinfile:
#     dest: /etc/ssh/sshd_config
#     backup: yes
#     insertafter: '^#PermitRootLogin prohibit-password'
#     regexp: '^PermitRootLogin'
#     line: 'PermitRootLogin yes'
#   notify:
#     - Restart OpenSSH

- name: Start OpenSSH
  tags: openssh
  become: yes
  service:
    name: sshd
    state: started
    enabled: yes
